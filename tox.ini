[tox]
envlist = copying,cli,{py27,py35}-{lint,tests}

[testenv]
whitelist_externals =
    cli:   {[testenv:cli]whitelist_externals}
deps=
    -rtests_utils/test-requirements.txt
commands=
    tests:       {[testenv:tests]commands}
    lint:        {[testenv:lint]commands}
    integration: {[testenv:integration]commands}
    cli:         {[testenv:cli]commands}
    coverage:    {[testenv:coverage]commands}

[testenv:tests]
commands=
    pytest -v iotlabcli --doctest-modules --cov=iotlabcli --ignore=iotlabcli/integration

[testenv:lint]
commands=
    python setup.py lint
    python setup.py pep8
    flake8

[testenv:copying]
whitelist_externals = /bin/bash
commands=
    bash tests_utils/check_license.sh

[testenv:cli]
whitelist_externals = /bin/bash
commands=
    bash -exc "for i in *-cli; do $i --help >/dev/null; done"

[testenv:coverage]
passenv = CI TRAVIS TRAVIS_*
commands = codecov -e TOXENV

[testenv:integration]
deps=
    -rtests_utils/test-requirements.txt
passenv = IOTLAB_TEST_PASSWORD
commands=
    pytest -v iotlabcli/integration --cov=iotlabcli/integration
